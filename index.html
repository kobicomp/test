<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת הזמנות פשוטה</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --warning-color: #fbbc05;
            --error-color: #ea4335;
            --light-gray: #f8f9fa;
            --border-color: #dadce0;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            direction: rtl;
        }

        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="tel"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin-right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #1669d9;
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: #f1f3f4;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }

        .success {
            background-color: #e6f4ea;
            color: var(--secondary-color);
            border: 1px solid #ceead6;
        }

        .error {
            background-color: #fce8e6;
            color: var(--error-color);
            border: 1px solid #fdded9;
        }

        .info {
            background-color: #e8f0fe;
            color: var(--primary-color);
            border: 1px solid #d2e3fc;
        }

        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .stats-value {
            font-weight: bold;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>מערכת הזמנות פשוטה</h1>

        <div class="stats" id="stats">
            <h2>סטטוס הזמנות</h2>
            <div class="stats-item">
                <span>מספר המקומות הכולל:</span>
                <span class="stats-value" id="total-slots">20</span>
            </div>
            <div class="stats-item">
                <span>מקומות פנויים:</span>
                <span class="stats-value" id="available-slots">20</span>
            </div>
            <div class="stats-item">
                <span>עדכון אחרון:</span>
                <span id="last-update">כעת</span>
            </div>
        </div>

        <div id="reservation-form">
            <h2>טופס הזמנה</h2>
            <div class="form-group">
                <label for="firstName">שם פרטי:</label>
                <input type="text" id="firstName" name="firstName" required>
            </div>
            <div class="form-group">
                <label for="lastName">שם משפחה:</label>
                <input type="text" id="lastName" name="lastName" required>
            </div>
            <div class="form-group">
                <label for="phone">מספר טלפון:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            
            <button id="reserve-btn" class="btn">שלח הזמנה</button>
        </div>

        <div class="loader" id="loader">
            <div class="loader-spinner"></div>
            <p>מבצע פעולה...</p>
        </div>

        <div class="status success" id="success-message"></div>
        <div class="status error" id="error-message"></div>
        <div class="status info" id="info-message"></div>
    </div>

    <script>
        // הגדרות המערכת
        const CONFIG = {
            // מספר המקומות הכולל
            TOTAL_SLOTS: 20,
            
            // מספר הזמנות שבוצעו - מוחזק במקומית
            RESERVATIONS_KEY: 'room_reservations_count',
            
            // כתובת טופס הגוגל
            FORM_URL: 'https://docs.google.com/forms/d/e/1FAIpQLSfMRzTBNEKqeg_ubQwhPNr9u78h5a3ynPdsq7q77azwKF9S9g/formResponse',
            
            // שדות הטופס
            FORM_FIELDS: {
                firstName: "entry.1726269772",
                lastName: "entry.1766470893",
                phone: "entry.2028941780",
                status: "entry.1406108683"
            }
        };

        // אלמנטים בדף
        const elements = {
            totalSlots: document.getElementById('total-slots'),
            availableSlots: document.getElementById('available-slots'),
            lastUpdate: document.getElementById('last-update'),
            reserveBtn: document.getElementById('reserve-btn'),
            loader: document.getElementById('loader'),
            successMessage: document.getElementById('success-message'),
            errorMessage: document.getElementById('error-message'),
            infoMessage: document.getElementById('info-message'),
            firstName: document.getElementById('firstName'),
            lastName: document.getElementById('lastName'),
            phone: document.getElementById('phone')
        };

        // פונקציות עזר
        const helpers = {
            // הצגת הודעה למשתמש
            showMessage: function(type, message) {
                // ניקוי הודעות קודמות
                elements.successMessage.style.display = 'none';
                elements.errorMessage.style.display = 'none';
                elements.infoMessage.style.display = 'none';
                
                // הצגת ההודעה המתאימה
                if (type === 'success') {
                    elements.successMessage.textContent = message;
                    elements.successMessage.style.display = 'block';
                } else if (type === 'error') {
                    elements.errorMessage.textContent = message;
                    elements.errorMessage.style.display = 'block';
                } else if (type === 'info') {
                    elements.infoMessage.textContent = message;
                    elements.infoMessage.style.display = 'block';
                }
                
                // הסתרת ההודעה אחרי 5 שניות
                setTimeout(() => {
                    if (type === 'success') elements.successMessage.style.display = 'none';
                    if (type === 'error') elements.errorMessage.style.display = 'none';
                    if (type === 'info') elements.infoMessage.style.display = 'none';
                }, 5000);
            },
            
            // הצגת/הסתרת מסך טעינה
            showLoader: function(show) {
                elements.loader.style.display = show ? 'block' : 'none';
            },
            
            // קבלת מספר ההזמנות הנוכחי
            getReservationsCount: function() {
                const count = localStorage.getItem(CONFIG.RESERVATIONS_KEY);
                return count ? parseInt(count) : 0;
            },
            
            // עדכון מספר ההזמנות
            setReservationsCount: function(count) {
                localStorage.setItem(CONFIG.RESERVATIONS_KEY, count.toString());
                this.updateDisplay();
            },
            
            // עדכון התצוגה
            updateDisplay: function() {
                const count = this.getReservationsCount();
                const available = Math.max(0, CONFIG.TOTAL_SLOTS - count);
                
                elements.totalSlots.textContent = CONFIG.TOTAL_SLOTS;
                elements.availableSlots.textContent = available;
                elements.lastUpdate.textContent = new Date().toLocaleTimeString();
                
                // בדיקה אם נגמרו המקומות
                if (available <= 0) {
                    helpers.showMessage('info', 'כל המקומות תפוסים כרגע');
                    elements.reserveBtn.disabled = true;
                } else {
                    elements.reserveBtn.disabled = false;
                }
            },
            
            // שליחת הטופס
            submitFormWithIframe: function(formData) {
                // יצירת טופס זמני
                const form = document.createElement('form');
                form.action = CONFIG.FORM_URL;
                form.method = 'POST';
                form.target = 'submission-frame';
                form.style.display = 'none';
                
                // הוספת השדות לטופס
                for (const [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }
                
                // יצירת iframe להגשה
                const iframe = document.createElement('iframe');
                iframe.name = 'submission-frame';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                // טיפול באירועי הגשה
                iframe.addEventListener('load', function() {
                    // עדכון מספר ההזמנות
                    const currentCount = helpers.getReservationsCount();
                    helpers.setReservationsCount(currentCount + 1);
                    
                    // איפוס הטופס
                    elements.firstName.value = '';
                    elements.lastName.value = '';
                    elements.phone.value = '';
                    
                    helpers.showLoader(false);
                    helpers.showMessage('success', 'ההזמנה נשלחה בהצלחה!');
                    
                    // הסרת הטופס והאייפריים
                    setTimeout(() => {
                        document.body.removeChild(form);
                        document.body.removeChild(iframe);
                    }, 1000);
                });
                
                // הוספת הטופס לעמוד ושליחתו
                document.body.appendChild(form);
                form.submit();
            }
        };

        // אירועים
        const events = {
            // שליחת הזמנה
            submitReservation: function(e) {
                e.preventDefault();
                
                // בדיקות תקינות
                const firstName = elements.firstName.value.trim();
                const lastName = elements.lastName.value.trim();
                const phone = elements.phone.value.trim();
                
                if (!firstName || !lastName || !phone) {
                    helpers.showMessage('error', 'נא למלא את כל השדות הנדרשים');
                    return;
                }
                
                if (phone.length < 9 || !/^\d+$/.test(phone)) {
                    helpers.showMessage('error', 'מספר טלפון לא תקין');
                    return;
                }
                
                // בדיקה אם יש מקומות פנויים
                const availableSlots = CONFIG.TOTAL_SLOTS - helpers.getReservationsCount();
                if (availableSlots <= 0) {
                    helpers.showMessage('error', 'מצטערים, כל המקומות תפוסים כרגע');
                    return;
                }
                
                helpers.showLoader(true);
                
                // שליחת הנתונים לטופס
                const formData = new FormData();
                formData.append(CONFIG.FORM_FIELDS.firstName, firstName);
                formData.append(CONFIG.FORM_FIELDS.lastName, lastName);
                formData.append(CONFIG.FORM_FIELDS.phone, phone);
                formData.append(CONFIG.FORM_FIELDS.status, "הוזמן");
                
                // שליחה באמצעות iframe מוסתר
                helpers.submitFormWithIframe(formData);
            },
            
            // איפוס המערכת (לצורכי בדיקה)
            resetSystem: function() {
                if (confirm('האם ברצונך לאפס את מספר ההזמנות? פעולה זו תשמש לצורכי בדיקה בלבד.')) {
                    localStorage.removeItem(CONFIG.RESERVATIONS_KEY);
                    helpers.updateDisplay();
                    helpers.showMessage('info', 'המערכת אופסה בהצלחה');
                }
            }
        };

        // אתחול המערכת
        function init() {
            // עדכון התצוגה הראשונית
            helpers.updateDisplay();
            
            // הגדרת אירועים
            elements.reserveBtn.addEventListener('click', events.submitReservation);
            
            // הוספת אפשרות איפוס (בלחיצה כפולה על הכותרת - לצורכי בדיקה)
            document.querySelector('h1').addEventListener('dblclick', events.resetSystem);
        }

        // אתחול המערכת כשהדף נטען
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
